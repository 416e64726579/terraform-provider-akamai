From e43b81044d5ea2deca13948d5c7ae0319eee022a Mon Sep 17 00:00:00 2001
From: Rob Rodriguez <rrodrigu@akamai.com>
Date: Tue, 18 Aug 2020 07:25:02 -0700
Subject: [PATCH] adding check for at least one provider state set

---
 pkg/akamai/errors.go   |  3 +++
 pkg/akamai/provider.go | 12 ++++++++++++
 2 files changed, 15 insertions(+)

diff --git a/pkg/akamai/errors.go b/pkg/akamai/errors.go
index 9e7f5f6..0e7117c 100644
--- a/pkg/akamai/errors.go
+++ b/pkg/akamai/errors.go
@@ -18,6 +18,9 @@ var (
 	// ErrDuplicateSchemaKey is returned when a duplicate schema key is detected during merge
 	ErrDuplicateSchemaKey = &Error{"duplicate schema key", false}
 
+	// ErrNoConfiguredProviders is returned when no providers are configured
+	ErrNoConfiguredProviders = &Error{"One or more Akamai Edgegrid provider configurations must be defined", false}
+
 	// ErrCacheEntryNotFound returns a cache entry error
 	ErrCacheEntryNotFound = func(key string) error { return &Error{fmt.Sprintf("cache entry %q not found", key), true} }
 )
diff --git a/pkg/akamai/provider.go b/pkg/akamai/provider.go
index 2d8087f..63594d8 100644
--- a/pkg/akamai/provider.go
+++ b/pkg/akamai/provider.go
@@ -141,6 +141,18 @@ func Provider(log hclog.Logger, provs ...Subprovider) plugin.ProviderFunc {
 				instance.states[p.Name()] = state
 			}
 
+			stateSet := false
+			for _, s := range instance.states {
+				if s != nil {
+					stateSet = true
+					break
+				}
+			}
+
+			if !stateSet {
+				return nil, ErrNoConfiguredProviders.Diagnostics()
+			}
+
 			// TODO: once the client is update this will be done elsewhere
 			client.UserAgent = instance.UserAgent("terraform-provider-akamai", instance.TerraformVersion)
 
-- 
2.25.1

